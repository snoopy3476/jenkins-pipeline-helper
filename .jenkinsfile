GLOBAL_POD_TEMPLATE_TEST='
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: test
    image: ubuntu:latest
    command:
    - sleep
  - name: test2
    image: ubuntu:latest
    command:
    - sleep
'


podTemplate(yaml:GLOBAL_POD_TEMPLATE_TEST,workspaceVolume:hostPathWorkspaceVolume) {

pipeline {

	agent {
		docker {
			image 'docker:dind'
			args '-u root:root -p 3000:3000 --privileged -v /var/run/docker.sock:/var/run/docker.sock'
		}
	}

	stages {
		// build stage
		stage('build') {
//			agent { docker 'gradle:6.9.0-jdk11' }
			steps {

				echo 'Notify to GitLab - build stage pending'
				updateGitlabCommitStatus name: 'build', state: 'pending'

				echo '- Build'
				sleep 10

				echo 'Notify to GitLab - build stage success'
				updateGitlabCommitStatus name: 'build', state: 'success'
			}
		}

		// test stage
		stage('test') {
//			agent { docker 'gradle:6.9.0-jdk11' }
			steps {
				echo 'Notify to GitLab - test stage success'
				updateGitlabCommitStatus name: 'test', state: 'pending'

				echo '- Test'
				sleep 10

				echo 'Notify to GitLab - test stage success'
				updateGitlabCommitStatus name: 'test', state: 'success'
			}
		}

		// pull stage
		stage('push') {
			steps {
				echo 'Notify to GitLab - push stage success'
				updateGitlabCommitStatus name: 'push', state: 'pending'

				echo '- Push'
				sleep 10

				echo 'Notify to GitLab - push stage success'
				updateGitlabCommitStatus name: 'push', state: 'success'
			}
		}
	}
}




}
